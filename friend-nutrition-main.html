<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ „é¤Šæƒ…å ± | æ¢¶æœ¬ã‚¯ãƒªãƒ‹ãƒƒã‚¯</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile-layout.css">
    <style>
        .nutrition-list li {
            margin-bottom: 0.8rem;
            line-height: 1.5;
            font-size: 0.9rem;
            color: #444;
        }

        .nutrition-list strong {
            color: #2c7be5;
        }

        /* Recipe Overrides */
        #recipeContainer {
            margin-top: 1rem;
        }

        .pdf-collapsible {
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            border: 1px solid #eee;
        }

        .pdf-collapsible-header {
            padding: 1rem;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            background: #fafafa;
        }

        .pdf-collapsible-content {
            display: none;
            padding: 1rem;
            background: white;
        }

        .pdf-collapsible.is-open .pdf-collapsible-content {
            display: block;
        }

        .pdf-link-mobile {
            display: inline-block;
            background: #2c7be5;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9rem;
        }
    </style>
</head>

<body class="theme-nutrition app-mode">
    <header class="app-header">
        <a href="friend-main.html"
            style="position:absolute; left:1rem; font-size:1.5rem; color:#333; text-decoration:none;">&lt;</a>
        <div class="app-title">æ „é¤Šæƒ…å ±</div>
    </header>

    <main class="app-content-scroll">
        <nav class="app-segmented-control">
            <button class="app-segmented-item active" onclick="switchTab('info')">åŸºæœ¬</button>
            <button class="app-segmented-item" onclick="switchTab('recipe')">ãƒ¬ã‚·ãƒ”</button>
            <button class="app-segmented-item" onclick="switchTab('quiz')">ã‚¯ã‚¤ã‚º</button>
            <button class="app-segmented-item" onclick="switchTab('qa')">Q&A</button>
        </nav>

        <!-- Tab 1: Info -->
        <section id="info" class="app-page-section active">
            <div class="app-card-generic">
                <h2 style="font-size:1.1rem; text-align:center; margin-bottom:0.8rem; color:#2c7be5;">é£Ÿäº‹ç™‚æ³•ã®5ã¤ã®åŸºæœ¬</h2>
                <ul class="nutrition-list" style="padding-left:1.2rem;">
                    <li><strong>æ°´åˆ†ãƒ»å¡©åˆ†:</strong> æ‘‚ã‚Šã™ãã¯è¡€åœ§ä¸Šæ˜‡ã‚„å¿ƒè² æ‹…ã®åŸå› ã«ã€‚</li>
                    <li><strong>ã‚«ãƒªã‚¦ãƒ :</strong> é‡èœã‚„æœç‰©ã¯èŒ¹ã§ã“ã¼ã—ç­‰ã®å·¥å¤«ã‚’ã€‚</li>
                    <li><strong>ãƒªãƒ³:</strong> åŠ å·¥é£Ÿå“ã‚„ä¹³è£½å“ã«æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚</li>
                    <li><strong>ãŸã‚“ã±ãè³ª:</strong> æ‘‚ã‚Šã™ãã‚‹ã¨è€å»ƒç‰©ãŒå¢—ãˆã¾ã™ã€‚</li>
                    <li><strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼:</strong> ç‚­æ°´åŒ–ç‰©ã‚„è„‚è³ªã§ã—ã£ã‹ã‚Šç¢ºä¿ã€‚</li>
                </ul>
            </div>
            <div class="app-card-generic" style="background:#e3f2fd; border-color:#bbdefb;">
                <p style="font-size:0.9rem; text-align:center; margin:0; color:#0d47a1;">
                    é©åˆ‡ãªé£Ÿäº‹ç®¡ç†ã¯ã€é€æã‚’æ¥½ã«ã—ã€åˆä½µç—‡ã‚’äºˆé˜²ã—ã¾ã™ã€‚
                </p>
            </div>
        </section>

        <!-- Tab 2: Recipe -->
        <section id="recipe" class="app-page-section">
            <h3 style="font-size:1rem; margin:0 0.5rem 0.5rem;">ãŠã™ã™ã‚ãƒ¬ã‚·ãƒ”</h3>
            <div id="recipeContainer">
                <p style="text-align:center; padding:2rem; color:#888;">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </section>

        <!-- Tab 3: Quiz -->
        <section id="quiz" class="app-page-section">
            <div class="app-card-generic" style="text-align:center; padding:3rem 1.5rem;">
                <h2 style="margin-bottom:1rem;">æ „é¤Šã‚¯ã‚¤ã‚º</h2>
                <p style="margin-bottom:2rem;">é£Ÿäº‹ç®¡ç†ã«å½¹ç«‹ã¤çŸ¥è­˜ã‚’ã‚²ãƒ¼ãƒ æ„Ÿè¦šã§ï¼</p>
                <a href="friend-nutrition-quiz.html" class="quiz-button"
                    style="display:inline-block; padding:12px 30px; background:#2c7be5; color:white; border-radius:30px; text-decoration:none; font-weight:bold; box-shadow:0 4px 10px rgba(44,123,229,0.3);">
                    æŒ‘æˆ¦ã™ã‚‹
                </a>
            </div>
        </section>

        <!-- Tab 4: Q&A -->
        <section id="qa" class="app-page-section qa-search-section" data-csv-path="files/data/qa-data.csv"
            data-category="æ „é¤Š">
            <div class="qa-search-container" style="margin-bottom:1rem;">
                <input type="search" class="qa-search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ (ä¾‹: ãƒªãƒ³, å¤–é£Ÿ)" autocomplete="off"
                    style="width:100%; padding:12px; border-radius:12px; border:1px solid #ddd; background:rgba(255,255,255,0.9);">
            </div>
            <div class="keyword-buttons" style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:1.5rem;">
                <button class="keyword-button" onclick="setKeyword('ãƒªãƒ³')"
                    style="padding:6px 12px; border-radius:20px; border:none; background:#eee; font-size:0.8rem;">ãƒªãƒ³</button>
                <button class="keyword-button" onclick="setKeyword('ã‚«ãƒªã‚¦ãƒ ')"
                    style="padding:6px 12px; border-radius:20px; border:none; background:#eee; font-size:0.8rem;">ã‚«ãƒªã‚¦ãƒ </button>
                <button class="keyword-button" onclick="setKeyword('å¡©åˆ†')"
                    style="padding:6px 12px; border-radius:20px; border:none; background:#eee; font-size:0.8rem;">å¡©åˆ†</button>
            </div>
            <div class="qa-results-container"></div>
        </section>

        <div style="height: 40px;"></div>
    </main>

    <nav class="bottom-nav">
        <a href="friend-main.html" class="nav-item">
            <span class="nav-icon">ğŸ</span>
            <span>ãŠå‹é”</span>
        </a>
        <a href="qa-main.html" class="nav-item">
            <span class="nav-icon">â“</span>
            <span>Q&A</span>
        </a>
    </nav>

    <script>
        function switchTab(id) {
            document.querySelectorAll('.app-page-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.app-segmented-item').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');

            const buttons = document.querySelectorAll('.app-segmented-item');
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick').includes(id)) {
                    btn.classList.add('active');
                }
            });
        }
        window.switchTab = switchTab;

        window.setKeyword = function (word) {
            const input = document.querySelector('.qa-search-input');
            if (input) {
                input.value = word;
                input.dispatchEvent(new Event('input', { bubbles: true }));
            }
        }

        function togglePdf(header) {
            const container = header.parentElement;
            container.classList.toggle('is-open');
        }
        window.togglePdf = togglePdf;
    </script>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { firebaseConfig } from './js/firebase-config.js';

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            async function loadRecipes() {
                const container = document.getElementById('recipeContainer');
                try {
                    const q = query(collection(db, 'recipes'), orderBy('uploadedAt', 'desc'));
                    const snapshot = await getDocs(q);

                    if (snapshot.empty) {
                        container.innerHTML = '<p style="text-align:center;">ãƒ¬ã‚·ãƒ”ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                        return;
                    }

                    container.innerHTML = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return `
                        <div class="pdf-collapsible" data-pdf="${data.storageUrl}">
                            <div class="pdf-collapsible-header" onclick="togglePdf(this)">
                                <span>ğŸ³ ${data.title}</span>
                                <span>â–¼</span>
                            </div>
                            <div class="pdf-collapsible-content">
                                <p style="font-size:0.85rem; text-align:center; margin-bottom:1rem;">ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§è¦‹ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™</p>
                                <div style="text-align:center;">
                                    <a href="${data.storageUrl}" target="_blank" class="pdf-link-mobile">PDFã‚’é–‹ã</a>
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Recipe error:', error);
                    container.innerHTML = '<p style="color:red; text-align:center;">ãƒ¬ã‚·ãƒ”ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
                }
            }
            loadRecipes();
        } catch (e) {
            console.error('Firebase init error:', e);
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="js/qa/qa-data-embedded.js"></script>
    <script src="js/qa/qa-script.js"></script>
</body>

</html>