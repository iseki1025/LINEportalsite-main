<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é£Ÿäº‹ç™‚æ³• | æ¢¶æœ¬ã‚¯ãƒªãƒ‹ãƒƒã‚¯</title>
    <link rel="stylesheet" href="portal-design.css">
    <style>
        /* Nutrition theme: Orange */
        .hero-section.theme-nutrition {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.08) 100%);
        }

        .hero-section.theme-nutrition .hero-title {
            color: #b45309;
        }

        .tab-nav {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-lg);
            background: var(--bg-card);
            padding: var(--spacing-xs);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        .tab-btn {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-xs);
            border-radius: var(--radius-md);
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-align: center;
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Info Card */
        .info-card {
            background: rgba(245, 158, 11, 0.08);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .info-card h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #b45309;
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .info-card ul {
            padding-left: var(--spacing-lg);
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .info-card ul strong {
            color: #b45309;
        }

        .tip-card {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            text-align: center;
            color: #b45309;
            font-size: 0.9rem;
        }

        /* Recipe Card */
        .recipe-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .recipe-item {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-lg);
            background: rgba(245, 158, 11, 0.08);
            cursor: pointer;
        }

        .recipe-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .recipe-content {
            display: none;
            padding: var(--spacing-md) var(--spacing-lg);
            text-align: center;
        }

        .recipe-item.open .recipe-content {
            display: block;
        }

        .pdf-btn {
            display: inline-block;
            padding: var(--spacing-sm) var(--spacing-xl);
            background: #f59e0b;
            color: white;
            border-radius: var(--radius-full);
            font-weight: 600;
        }

        /* Quiz Card */
        .quiz-card {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.08) 100%);
            border-radius: var(--radius-lg);
            padding: var(--spacing-2xl);
            text-align: center;
        }

        .quiz-btn {
            display: inline-block;
            padding: var(--spacing-md) var(--spacing-2xl);
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border-radius: var(--radius-full);
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        /* Q&A */
        .qa-section-intro {
            background: rgba(245, 158, 11, 0.08);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }

        .keyword-btn.orange {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 1px solid #fcd34d;
            color: #b45309;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="app-header">
        <a href="friend-main.html" class="header-back">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        </a>
        <div class="header-title">é£Ÿäº‹ç™‚æ³•</div>
        <div style="width: 36px;"></div>
    </header>

    <!-- Main Content -->
    <main class="main-content">

        <!-- Hero -->
        <section class="hero-section theme-nutrition">
            <h1 class="hero-title">é£Ÿäº‹ç™‚æ³•ã®åŸºæœ¬</h1>
            <p class="hero-subtitle">é©åˆ‡ãªé£Ÿäº‹ç®¡ç†ã§é€æã‚’æ¥½ã«ã€‚</p>
        </section>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('info')">åŸºæœ¬</button>
            <button class="tab-btn" onclick="switchTab('recipe')">ãƒ¬ã‚·ãƒ”</button>
            <button class="tab-btn" onclick="switchTab('quiz')">ã‚¯ã‚¤ã‚º</button>
            <button class="tab-btn" onclick="switchTab('qa')">Q&A</button>
        </nav>

        <!-- Tab 1: Info -->
        <section id="info" class="tab-content active">
            <div class="info-card">
                <h3>é£Ÿäº‹ç™‚æ³•ã®5ã¤ã®åŸºæœ¬</h3>
                <ul>
                    <li><strong>æ°´åˆ†ãƒ»å¡©åˆ†:</strong> æ‘‚ã‚Šã™ãã¯è¡€åœ§ä¸Šæ˜‡ã‚„å¿ƒè² æ‹…ã®åŸå› ã«ã€‚</li>
                    <li><strong>ã‚«ãƒªã‚¦ãƒ :</strong> é‡èœã‚„æœç‰©ã¯èŒ¹ã§ã“ã¼ã—ç­‰ã®å·¥å¤«ã‚’ã€‚</li>
                    <li><strong>ãƒªãƒ³:</strong> åŠ å·¥é£Ÿå“ã‚„ä¹³è£½å“ã«æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚</li>
                    <li><strong>ãŸã‚“ã±ãè³ª:</strong> æ‘‚ã‚Šã™ãã‚‹ã¨è€å»ƒç‰©ãŒå¢—ãˆã¾ã™ã€‚</li>
                    <li><strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼:</strong> ç‚­æ°´åŒ–ç‰©ã‚„è„‚è³ªã§ã—ã£ã‹ã‚Šç¢ºä¿ã€‚</li>
                </ul>
            </div>
            <div class="tip-card">
                é©åˆ‡ãªé£Ÿäº‹ç®¡ç†ã¯ã€é€æã‚’æ¥½ã«ã—ã€åˆä½µç—‡ã‚’äºˆé˜²ã—ã¾ã™ã€‚
            </div>
        </section>

        <!-- Tab 2: Recipe -->
        <section id="recipe" class="tab-content">
            <h3 class="section-title">ãŠã™ã™ã‚ãƒ¬ã‚·ãƒ”</h3>
            <div class="recipe-list" id="recipeContainer">
                <p style="text-align: center; color: var(--text-muted); padding: var(--spacing-xl);">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </section>

        <!-- Tab 3: Quiz -->
        <section id="quiz" class="tab-content">
            <div class="quiz-card">
                <h2 style="color: #b45309; margin-bottom: var(--spacing-md);">æ „é¤Šã‚¯ã‚¤ã‚º</h2>
                <p style="color: var(--text-secondary); margin-bottom: var(--spacing-xl);">é£Ÿäº‹ç®¡ç†ã«å½¹ç«‹ã¤çŸ¥è­˜ã‚’ã‚²ãƒ¼ãƒ æ„Ÿè¦šã§ï¼</p>
                <a href="friend-nutrition-quiz.html" class="quiz-btn">æŒ‘æˆ¦ã™ã‚‹</a>
            </div>
        </section>

        <!-- Tab 4: Q&A (Compatible with qa-script.js) -->
        <section id="qa" class="tab-content qa-search-section" data-category="æ „é¤Š">
            <div class="qa-section-intro">
                <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€æ „é¤Šé–¢é€£ã®è³ªå•ã‚’æ¤œç´¢ã§ãã¾ã™ã€‚
                </p>
                <input type="search" class="search-input qa-search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ (ä¾‹: ãƒªãƒ³, å¤–é£Ÿ)"
                    autocomplete="off">
                <div class="keyword-buttons mt-md">
                    <button class="keyword-btn orange" onclick="setKeyword('ãƒªãƒ³')">ãƒªãƒ³</button>
                    <button class="keyword-btn orange" onclick="setKeyword('ã‚«ãƒªã‚¦ãƒ ')">ã‚«ãƒªã‚¦ãƒ </button>
                    <button class="keyword-btn orange" onclick="setKeyword('å¡©åˆ†')">å¡©åˆ†</button>
                </div>
            </div>
            <div class="qa-results-container">
                <!-- Q&A items loaded here by qa-script.js -->
            </div>
        </section>

        <!-- Copyright -->
        <footer class="copyright mt-xl">
            <a href="index.html" class="stealth-link">Â© 2025 Kajimoto Clinic</a>
        </footer>

    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="friend-main.html" class="nav-item active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 12 20 22 4 22 4 12"></polyline>
                <rect x="2" y="7" width="20" height="5"></rect>
            </svg>
            <span>ç‰¹å…¸ãƒˆãƒƒãƒ—</span>
        </a>
        <a href="qa-main.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <span>Q&A</span>
        </a>
    </nav>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="js/qa/qa-data-embedded.js"></script>
    <script src="js/qa/qa-script.js"></script>
    <script>
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        function setKeyword(word) {
            const input = document.querySelector('.qa-search-input');
            if (input) {
                input.value = word;
                input.dispatchEvent(new Event('input', { bubbles: true }));
            }
        }

        function toggleRecipe(header) {
            header.parentElement.classList.toggle('open');
        }
    </script>

    <!-- Firebase Recipe Loading -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { firebaseConfig } from './js/firebase-config.js';

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            async function loadRecipes() {
                const container = document.getElementById('recipeContainer');
                try {
                    const q = query(collection(db, 'recipes'), orderBy('uploadedAt', 'desc'));
                    const snapshot = await getDocs(q);

                    if (snapshot.empty) {
                        container.innerHTML = '<p style="text-align:center; color: var(--text-muted);">ãƒ¬ã‚·ãƒ”ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                        return;
                    }

                    container.innerHTML = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return `
                        <div class="recipe-item">
                            <div class="recipe-header" onclick="toggleRecipe(this)">
                                <span class="recipe-title">ğŸ³ ${data.title}</span>
                                <span>â–¼</span>
                            </div>
                            <div class="recipe-content">
                                <p style="font-size: 0.85rem; margin-bottom: var(--spacing-md); color: var(--text-muted);">ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§è¦‹ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™</p>
                                <a href="${data.storageUrl}" target="_blank" class="pdf-btn">PDFã‚’é–‹ã</a>
                            </div>
                        </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Recipe error:', error);
                    container.innerHTML = '<p style="color: var(--accent-disaster); text-align:center;">ãƒ¬ã‚·ãƒ”ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
                }
            }
            loadRecipes();
        } catch (e) {
            console.error('Firebase init error:', e);
        }
    </script>

</body>

</html>