<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€ææƒ…å ±ãƒãƒ¼ã‚¿ãƒ« | æ „é¤Šæƒ…å ±</title>
    <link rel="stylesheet" href="style.css">
    <script>
        if (window.location.protocol === 'file:') {
            window.addEventListener('DOMContentLoaded', () => {
                const container = document.getElementById('recipeContainer');
                if (container) {
                    container.innerHTML = '<p style="padding:1rem; color:#e53e3e; background:#fff5f5; border-radius:8px; text-align:center;">' +
                        '<strong>âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«é–²è¦§åˆ¶é™</strong><br>' +
                        'ãƒ¬ã‚·ãƒ”ã®èª­ã¿è¾¼ã¿ã«ã¯ <code>http://</code> ã‚µãƒ¼ãƒãƒ¼ãŒå¿…è¦ã§ã™ã€‚<br>' +
                        '<code>start_server.bat</code> ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚</p>';
                }
            });
        }
    </script>
</head>

<body class="theme-nutrition">
    <div class="container">
        <header>
            <h1>é€ææ‚£è€…ã•ã‚“ã®ãŸã‚ã®æ „é¤Šæƒ…å ±</h1>
        </header>
        <nav class="page-nav">
            <button class="nav-button active" onclick="switchTab('info')">æ „é¤Šã®åŸºæœ¬</button>
            <button class="nav-button" onclick="switchTab('recipe')">ãŠã™ã™ã‚<br>ãƒ¬ã‚·ãƒ”</button>
            <button class="nav-button" onclick="switchTab('quiz')">æ „é¤Šã‚¯ã‚¤ã‚º</button>
            <button class="nav-button" onclick="switchTab('qa')">æ „é¤ŠQ&A</button>
        </nav>

        <main id="content-area">
            <!-- â‘  æ „é¤Šã®åŸºæœ¬ -->
            <section id="info" class="content-section active">
                <h2>é€æã¨é£Ÿäº‹ã®ãŸã„ã›ã¤ãªé–¢ä¿‚</h2>
                <div class="intro-text">
                    <p>é©åˆ‡ãªé£Ÿäº‹ç®¡ç†ã¯ã€é€æã«ã‚ˆã‚‹ä½“ã®è² æ‹…ã‚’æ¸›ã‚‰ã—ã€åˆä½µç—‡ã‚’äºˆé˜²ã—ã¾ã™ã€‚</p>
                </div>

                <h3>é£Ÿäº‹ç™‚æ³•ã®5ã¤ã®åŸºæœ¬ãƒã‚¤ãƒ³ãƒˆ</h3>
                <ul>
                    <li><strong>æ°´åˆ†ãƒ»å¡©åˆ†:</strong> æ‘‚ã‚Šã™ãã¯è¡€åœ§ä¸Šæ˜‡ã‚„å¿ƒè² æ‹…ã®åŸå› ã«ãªã‚Šã¾ã™ã€‚</li>
                    <li><strong>ã‚«ãƒªã‚¦ãƒ :</strong> é‡èœã‚„æœç‰©ã«å¤šãå«ã¾ã‚Œã¾ã™ã€‚èŒ¹ã§ã“ã¼ã—ãªã©ã§å·¥å¤«ã‚’ã€‚</li>
                    <li><strong>ãƒªãƒ³:</strong> åŠ å·¥é£Ÿå“ã‚„ä¹³è£½å“ã«æ³¨æ„ã€‚éª¨ã‚„è¡€ç®¡ã‚’å®ˆã‚‹ãŸã‚ã«åˆ¶é™ãŒå¿…è¦ã§ã™ã€‚</li>
                    <li><strong>ãŸã‚“ã±ãè³ª:</strong> ä½“ã‚’ä½œã‚‹æ „é¤Šç´ ã§ã™ãŒã€æ‘‚ã‚Šã™ãã‚‹ã¨è€å»ƒç‰©ãŒå¢—ãˆã¾ã™ã€‚</li>
                    <li><strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼:</strong> åˆ¶é™ã—ã¤ã¤ã‚‚ã€ç‚­æ°´åŒ–ç‰©ã‚„è„‚è³ªã§ã—ã£ã‹ã‚Šç¢ºä¿ã—ã¾ã—ã‚‡ã†ã€‚</li>
                </ul>
            </section>

            <!-- â‘¡ ãŠã™ã™ã‚ãƒ¬ã‚·ãƒ” -->
            <section id="recipe" class="content-section">
                <h2>ãŠã™ã™ã‚ãƒ¬ã‚·ãƒ”</h2>
                <div id="recipeContainer">
                    <p style="text-align:center; padding:2rem;">èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
            </section>

            <!-- â‘¢ æ „é¤Šã‚¯ã‚¤ã‚º -->
            <section id="quiz" class="content-section">
                <div class="quiz-section">
                    <h2>æŒ‘æˆ¦ã—ã¦ã¿ã‚ˆã†ï¼é€ææ „é¤Šã‚¯ã‚¤ã‚º</h2>
                    <p>é£Ÿäº‹ç®¡ç†ã«å½¹ç«‹ã¤çŸ¥è­˜ãŒã‚²ãƒ¼ãƒ æ„Ÿè¦šã§èº«ã«ã¤ãã¾ã™ã€‚</p>
                    <a href="friend-nutrition-quiz.html" class="quiz-button">ã‚¯ã‚¤ã‚ºã«æŒ‘æˆ¦ã™ã‚‹ï¼</a>
                    <p style="margin-top:1rem; font-size:0.9rem;">ãƒ©ãƒ³ãƒ€ãƒ ã«5å•å‡ºé¡Œã•ã‚Œã¾ã™ã€‚</p>
                </div>
            </section>

            <!-- â‘£ æ „é¤ŠQ&A -->
            <section id="qa" class="content-section qa-search-section" data-csv-path="files/data/qa-data.csv"
                data-category="æ „é¤Š">
                <h2>æ „é¤Šã«ã¤ã„ã¦ã®Q&A</h2>
                <div class="qa-search-container">
                    <input type="search" class="qa-search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ (ä¾‹: ãƒªãƒ³, å¤–é£Ÿ)" autocomplete="off">
                </div>
                <div class="qa-popular-keywords">
                    <h3>ã‚ˆãæ¤œç´¢ã•ã‚Œã‚‹ãƒ¯ãƒ¼ãƒ‰</h3>
                    <div class="keyword-buttons">
                        <button class="keyword-button" onclick="setKeyword('ãƒªãƒ³')">ãƒªãƒ³</button>
                        <button class="keyword-button" onclick="setKeyword('ã‚«ãƒªã‚¦ãƒ ')">ã‚«ãƒªã‚¦ãƒ </button>
                        <button class="keyword-button" onclick="setKeyword('æ°´åˆ†')">æ°´åˆ†</button>
                        <button class="keyword-button" onclick="setKeyword('å¡©åˆ†')">å¡©åˆ†</button>
                    </div>
                </div>
                <div class="qa-results-container"></div>
            </section>
        </main>

        <a href="friend-main.html" class="back-to-portal-button">ç‰¹å…¸ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</a>
        <footer>
            <p><small>&copy; 2025 åŒ»ç™‚æ³•äºº å¥½è¼ä¼š æ¢¶æœ¬ã‚¯ãƒªãƒ‹ãƒƒã‚¯</small></p>
        </footer>
    </div>

    <!-- UI Logic: Global scope -->
    <script>
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(id) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');

            const buttons = document.querySelectorAll('.nav-button');
            for (let btn of buttons) {
                if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(id)) {
                    btn.classList.add('active');
                }
            }
        }
        window.switchTab = switchTab;

        // PDFé–‹é–‰ãƒ­ã‚¸ãƒƒã‚¯
        function togglePdf(header) {
            const container = header.parentElement;
            const pdfUrl = container.getAttribute('data-pdf');
            const content = container.querySelector('.pdf-collapsible-content');
            const embed = container.querySelector('embed');
            const loader = container.querySelector('.pdf-loading-container');

            container.classList.toggle('is-open');

            if (container.classList.contains('is-open') && !embed.src) {
                setTimeout(() => {
                    embed.src = pdfUrl + '#toolbar=0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                        embed.style.display = 'block';
                    }, 1500);
                }, 100);
            }
        }
        window.togglePdf = togglePdf;

        function setKeyword(word) {
            const input = document.querySelector('.content-section.active .qa-search-input');
            if (input) {
                input.value = word;
                input.dispatchEvent(new Event('input', { bubbles: true }));
            }
        }
        window.setKeyword = setKeyword;
    </script>

    <!-- Data Logic: Modules -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="js/qa/qa-script.js"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { firebaseConfig } from './js/firebase-config.js';

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            async function loadRecipes() {
                const container = document.getElementById('recipeContainer');
                try {
                    const q = query(collection(db, 'recipes'), orderBy('uploadedAt', 'desc'));
                    const snapshot = await getDocs(q);

                    if (snapshot.empty) {
                        container.innerHTML = '<p style="text-align:center;">ç¾åœ¨ã€å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ãƒ¬ã‚·ãƒ”ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                        return;
                    }

                    container.innerHTML = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return `
                        <div class="pdf-collapsible" data-pdf="${data.storageUrl}">
                            <div class="pdf-collapsible-header" onclick="togglePdf(this)">
                                <span>ğŸ³ ${data.title}</span>
                                <span>â–¼</span>
                            </div>
                            <div class="pdf-collapsible-content">
                                <div class="pdf-collapsible-body">
                                    <div class="pdf-mobile-notice">ğŸ“± ä¸‹ã®ãƒœã‚¿ãƒ³ã‹ã‚‰PDFã‚’é–‹ãã®ãŒãŠã™ã™ã‚ã§ã™</div>
                                    <div class="pdf-link-mobile-wrapper">
                                        <a href="${data.storageUrl}" target="_blank" class="pdf-link-mobile">PDFã‚’é–‹ã</a>
                                    </div>
                                    <div class="pdf-loading-container">
                                        <div class="pdf-spinner"></div><p>èª­ã¿è¾¼ã¿ä¸­...</p>
                                    </div>
                                    <embed src="" type="application/pdf" class="pdf-embed-desktop">
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Recipe load error:', error);
                    container.innerHTML = '<p style="padding:1rem; color:red;">ãƒ¬ã‚·ãƒ”ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>(Localç’°å¢ƒã§ã¯ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã®é–²è¦§ãŒå¿…è¦ã§ã™)</p>';
                }
            }
            loadRecipes();
        } catch (e) {
            console.error('Firebase init error:', e);
            document.getElementById('recipeContainer').innerHTML = '<p style="padding:1rem; color:red;">ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
        }
    </script>
</body>

</html>