<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ „é¤Šæƒ…å ± | æ¢¶æœ¬ã‚¯ãƒªãƒ‹ãƒƒã‚¯</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile-layout.css">
    <link rel="stylesheet" href="components.css">
    <style>
        /* Nutrition page theme: Orange/Amber */
        :root {
            --page-primary: #f59e0b;
            --page-primary-dark: #b45309;
            --page-bg-light: #fef3c7;
            --page-bg-lighter: #fffbeb;
        }

        .app-header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
            position: relative;
            overflow: hidden;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: -30px;
            right: -30px;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .app-header::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 20%;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
        }

        .app-segmented-item.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .quiz-button {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .keyword-button {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            color: var(--page-primary-dark);
        }

        .keyword-button:active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .qa-search-input {
            border: 2px solid #fcd34d;
        }

        .qa-search-input:focus {
            border-color: #f59e0b;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.2);
        }

        .nutrition-list strong {
            color: var(--page-primary-dark);
        }
    </style>
</head>

<body class="theme-friend app-mode">
    <header class="app-header">
        <a href="friend-main.html" class="back-button">&lt;</a>
        <div class="app-title">ğŸ§¡ æ „é¤Šæƒ…å ±</div>
    </header>

    <main class="app-content-scroll">
        <nav class="app-segmented-control">
            <button class="app-segmented-item active" onclick="switchTab('info')">åŸºæœ¬</button>
            <button class="app-segmented-item" onclick="switchTab('recipe')">ãƒ¬ã‚·ãƒ”</button>
            <button class="app-segmented-item" onclick="switchTab('quiz')">ã‚¯ã‚¤ã‚º</button>
            <button class="app-segmented-item" onclick="switchTab('qa')">Q&A</button>
        </nav>

        <!-- Tab 1: Info -->
        <section id="info" class="app-page-section active">
            <div class="app-card-generic" style="background: var(--page-bg-lighter);">
                <h2 style="font-size:1.1rem; text-align:center; margin-bottom:0.8rem; color: var(--page-primary-dark);">
                    é£Ÿäº‹ç™‚æ³•ã®5ã¤ã®åŸºæœ¬</h2>
                <ul class="nutrition-list" style="padding-left:1.2rem;">
                    <li><strong>æ°´åˆ†ãƒ»å¡©åˆ†:</strong> æ‘‚ã‚Šã™ãã¯è¡€åœ§ä¸Šæ˜‡ã‚„å¿ƒè² æ‹…ã®åŸå› ã«ã€‚</li>
                    <li><strong>ã‚«ãƒªã‚¦ãƒ :</strong> é‡èœã‚„æœç‰©ã¯èŒ¹ã§ã“ã¼ã—ç­‰ã®å·¥å¤«ã‚’ã€‚</li>
                    <li><strong>ãƒªãƒ³:</strong> åŠ å·¥é£Ÿå“ã‚„ä¹³è£½å“ã«æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚</li>
                    <li><strong>ãŸã‚“ã±ãè³ª:</strong> æ‘‚ã‚Šã™ãã‚‹ã¨è€å»ƒç‰©ãŒå¢—ãˆã¾ã™ã€‚</li>
                    <li><strong>ã‚¨ãƒãƒ«ã‚®ãƒ¼:</strong> ç‚­æ°´åŒ–ç‰©ã‚„è„‚è³ªã§ã—ã£ã‹ã‚Šç¢ºä¿ã€‚</li>
                </ul>
            </div>
            <div class="app-card-generic" style="background: var(--page-bg-light); border-color:#fcd34d;">
                <p style="font-size:0.9rem; text-align:center; margin:0; color: var(--page-primary-dark);">
                    é©åˆ‡ãªé£Ÿäº‹ç®¡ç†ã¯ã€é€æã‚’æ¥½ã«ã—ã€åˆä½µç—‡ã‚’äºˆé˜²ã—ã¾ã™ã€‚
                </p>
            </div>
        </section>

        <!-- Tab 2: Recipe -->
        <section id="recipe" class="app-page-section">
            <h3 style="font-size:1rem; margin:0 0.5rem 0.5rem;">ãŠã™ã™ã‚ãƒ¬ã‚·ãƒ”</h3>
            <div id="recipeContainer">
                <p style="text-align:center; padding:2rem; color:#888;">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </section>

        <!-- Tab 3: Quiz -->
        <section id="quiz" class="app-page-section">
            <div class="app-card-generic"
                style="text-align:center; padding:3rem 1.5rem; background: var(--page-bg-lighter);">
                <h2 style="margin-bottom:1rem; color: var(--page-primary-dark);">æ „é¤Šã‚¯ã‚¤ã‚º</h2>
                <p style="margin-bottom:2rem;">é£Ÿäº‹ç®¡ç†ã«å½¹ç«‹ã¤çŸ¥è­˜ã‚’ã‚²ãƒ¼ãƒ æ„Ÿè¦šã§ï¼</p>
                <a href="friend-nutrition-quiz.html" class="quiz-button">æŒ‘æˆ¦ã™ã‚‹</a>
            </div>
        </section>

        <!-- Tab 4: Q&A - Matching qa-main.html design with orange theme -->
        <section id="qa" class="app-page-section qa-search-section" data-csv-path="files/data/qa-data.csv"
            data-category="æ „é¤Š">
            <div class="app-card-generic"
                style="text-align:center; padding: 1.5rem 1rem; background: var(--page-bg-lighter);">
                <p style="font-size:0.95rem; color:#555; margin-bottom:1rem;">
                    ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€æ „é¤Šé–¢é€£ã®è³ªå•ã‚’æ¤œç´¢ã§ãã¾ã™ã€‚
                </p>

                <div class="qa-search-container" style="margin-bottom:1.5rem;">
                    <input type="search" class="qa-search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ (ä¾‹: ãƒªãƒ³, å¤–é£Ÿ)" autocomplete="off"
                        style="width:100%; padding:14px; border-radius:30px; border:2px solid #fcd34d; background:white; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
                </div>

                <div class="qa-popular-keywords">
                    <h3 style="font-size:0.9rem; color:#666; margin-bottom:0.8rem;">ã‚ˆãæ¤œç´¢ã•ã‚Œã‚‹ãƒ¯ãƒ¼ãƒ‰</h3>
                    <div class="keyword-buttons" style="display:flex; justify-content:center; gap:8px; flex-wrap:wrap;">
                        <button class="keyword-button" onclick="setKeyword('ãƒªãƒ³')">ãƒªãƒ³</button>
                        <button class="keyword-button" onclick="setKeyword('ã‚«ãƒªã‚¦ãƒ ')">ã‚«ãƒªã‚¦ãƒ </button>
                        <button class="keyword-button" onclick="setKeyword('å¡©åˆ†')">å¡©åˆ†</button>
                    </div>
                </div>

                <div class="qa-results-container" style="text-align:left; margin-top:2rem;"></div>
            </div>
        </section>

        <div style="height: 40px;"></div>
    </main>

    <nav class="bottom-nav">
        <a href="friend-main.html" class="nav-item">
            <div class="nav-icon">ğŸ</div>
            <span>ãŠå‹é”</span>
        </a>
        <a href="qa-main.html" class="nav-item">
            <div class="nav-icon">â“</div>
            <span>Q&A</span>
        </a>
    </nav>

    <script>
        function switchTab(id) {
            document.querySelectorAll('.app-page-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.app-segmented-item').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            const buttons = document.querySelectorAll('.app-segmented-item');
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick').includes(id)) {
                    btn.classList.add('active');
                }
            });
        }
        window.switchTab = switchTab;

        window.setKeyword = function (word) {
            const input = document.querySelector('.qa-search-input');
            if (input) { input.value = word; input.dispatchEvent(new Event('input', { bubbles: true })); }
        }

        function togglePdf(header) {
            const container = header.parentElement;
            container.classList.toggle('is-open');
        }
        window.togglePdf = togglePdf;
    </script>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { firebaseConfig } from './js/firebase-config.js';

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            async function loadRecipes() {
                const container = document.getElementById('recipeContainer');
                try {
                    const q = query(collection(db, 'recipes'), orderBy('uploadedAt', 'desc'));
                    const snapshot = await getDocs(q);

                    if (snapshot.empty) {
                        container.innerHTML = '<p style="text-align:center;">ãƒ¬ã‚·ãƒ”ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                        return;
                    }

                    container.innerHTML = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return `
                        <div class="pdf-collapsible" data-pdf="${data.storageUrl}">
                            <div class="pdf-collapsible-header" onclick="togglePdf(this)" style="background: var(--page-bg-light);">
                                <span>ğŸ³ ${data.title}</span>
                                <span>â–¼</span>
                            </div>
                            <div class="pdf-collapsible-content">
                                <p style="font-size:0.85rem; text-align:center; margin-bottom:1rem;">ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§è¦‹ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™</p>
                                <div style="text-align:center;">
                                    <a href="${data.storageUrl}" target="_blank" class="pdf-link-mobile" style="background: var(--page-primary);">PDFã‚’é–‹ã</a>
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Recipe error:', error);
                    container.innerHTML = '<p style="color:red; text-align:center;">ãƒ¬ã‚·ãƒ”ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
                }
            }
            loadRecipes();
        } catch (e) {
            console.error('Firebase init error:', e);
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="js/qa/qa-data-embedded.js"></script>
    <script src="js/qa/qa-script.js"></script>
</body>

</html>