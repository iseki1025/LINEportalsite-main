<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Å∑„Å´„Å∑„Å´„Ç¢„Éã„Éû„É´„Éª„Éû„Éº„Ç∏</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="components.css">
    <style>
        /* „Çπ„ÇØ„É≠„Éº„É´Á¶ÅÊ≠¢ & ÂÖ®ÁîªÈù¢Âõ∫ÂÆö */
        html,
        body {
            overflow: hidden;
            height: 100%;
            width: 100%;
            touch-action: none;
            user-select: none;
            margin: 0;
            padding: 0;
            position: fixed;
        }

        .game-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e0c3fc 0%, #c9b1ff 25%, #b8d4e3 50%, #b5ead7 75%, #ffc8dd 100%);
            z-index: 0;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.4;
            animation: float-up 8s infinite linear;
        }

        @keyframes float-up {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }

            10% {
                opacity: 0.4;
            }

            90% {
                opacity: 0.4;
            }

            100% {
                transform: translateY(-20vh) scale(1);
                opacity: 0;
            }
        }

        /* „Ç≥„É≥„ÉÜ„ÉäÈ°û */
        .game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            z-index: 10;
        }

        .unified-back-btn {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1000;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            color: #333;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.1s;
            font-family: "Noto Sans JP", sans-serif;
        }

        .unified-back-btn:active {
            transform: scale(0.95);
        }

        .game-header h1 {
            position: fixed;
            top: 25px;
            /* Moved down slightly */
            left: 0;
            width: 100%;
            text-align: center;
            margin: 0;
            font-size: 1.1rem;
            z-index: 50;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
            background: linear-gradient(135deg, #ff9a9e, #a18cd1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            pointer-events: none;
        }

        .game-area {
            width: 100%;
            height: calc(100% - 60px);
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding-left: 20px;
            box-sizing: border-box;
        }

        /* „Ç≤„Éº„É†„Éú„ÉÉ„ÇØ„Çπ */
        .game-box {
            position: relative;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.1) 100%);
            border: 4px solid rgba(255, 255, 255, 0.6);
            border-radius: 20px;
            overflow: hidden;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.15),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(8px);
        }

        .game-box canvas {
            display: block;
            background: transparent;
        }

        /* „Éá„ÉÉ„Éâ„É©„Ç§„É≥ */
        .deadline {
            position: absolute;
            top: 60px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 100, 100, 0.6), transparent);
            z-index: 10;
        }

        .deadline::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            right: 5px;
            top: -10px;
            font-size: 0.7rem;
        }

        /* „Ç¨„É©„Çπ„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .glass-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            border-radius: 16px;
        }

        /* „Ç≤„Éº„É†„Ç™„Éº„Éê„Éº„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .game-over-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            border-radius: 16px;
            z-index: 100;
        }

        .game-over-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .game-over-overlay h2 {
            color: #fff;
            font-size: 1.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
        }

        .game-over-overlay p {
            color: #fff;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        /* HUD„Éë„Éç„É´ - Âè≥ÂÅ¥Á∏¶ÈÖçÁΩÆ */
        .info-panel {
            position: fixed;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            border-radius: 16px;
            padding: 15px 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .info-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .label-text {
            font-size: 0.6rem;
            color: #888;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .score-val,
        .best-val {
            font-size: 1rem;
            font-weight: bold;
            background: linear-gradient(135deg, #a18cd1, #fbc2eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .separator {
            width: 80%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(160, 140, 200, 0.3), transparent);
            margin: 0 auto;
        }

        #nextCanvas {
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.5);
        }

        /* „Ç≥„É≥„Éà„É≠„Éº„É´„Éú„Çø„É≥ - Âè≥‰∏ã */
        .controls {
            position: fixed;
            bottom: 20px;
            right: 15px;
            z-index: 100;
        }

        .game-btn {
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: "Noto Sans JP", sans-serif;
        }

        .btn-start {
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(161, 140, 209, 0.4);
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(161, 140, 209, 0.5);
        }

        .btn-start:active {
            transform: translateY(0);
        }

        /* „Éû„Éº„Ç∏„Ç®„Éï„Çß„ÇØ„Éà */
        .merge-effect {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(255, 200, 220, 0.4) 50%, transparent 70%);
            animation: merge-pop 0.4s ease-out forwards;
            pointer-events: none;
            z-index: 50;
        }

        @keyframes merge-pop {
            0% {
                transform: scale(0.5);
                opacity: 1;
            }

            50% {
                transform: scale(1.5);
                opacity: 0.8;
            }

            100% {
                transform: scale(2);
                opacity: 0;
            }
        }
    </style>
</head>

<body class="theme-friend game-mode-fullscreen">
    <a href="friend-game-main.html" class="unified-back-btn">Êàª„Çã</a>
    <div class="game-bg"></div>
    <div class="particles" id="particles"></div>

    <!-- HUD„É¨„Ç§„É§„Éº -->
    <header class="game-header">
        <h1>üêæ „Å∑„Å´„Å∑„Å´„Ç¢„Éã„Éû„É´</h1>
    </header>

    <!-- HUD Information Panel (Vertical) -->
    <div class="info-panel">
        <!-- NEXT (Top) -->
        <div class="info-section">
            <span class="label-text">NEXT</span>
            <canvas id="nextCanvas" width="45" height="45"></canvas>
        </div>

        <div class="separator"></div>

        <!-- BEST (Middle) -->
        <div class="info-section">
            <span class="label-text">BEST</span>
            <span class="best-val" id="bestScore">0</span>
        </div>

        <div class="separator"></div>

        <!-- SCORE (Bottom) -->
        <div class="info-section">
            <span class="label-text">SCORE</span>
            <span class="score-val" id="score">0</span>
        </div>
    </div>

    <!-- HUD Controls (Bottom Right) -->
    <div class="controls">
        <button class="game-btn btn-start" id="startBtn">„Çπ„Çø„Éº„Éà</button>
    </div>

    <!-- Game Container -->
    <div class="game-container">
        <div class="game-area">
            <div class="game-box" id="gameBox">
                <div class="deadline"></div>
                <canvas id="gameCanvas"></canvas>
                <div class="glass-overlay"></div>
                <div class="game-over-overlay" id="gameOverOverlay">
                    <h2>üéÆ Game Over</h2>
                    <p>„Çπ„Ç≥„Ç¢: <span id="finalScore">0</span></p>
                    <button class="game-btn btn-start" id="restartBtn">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Matter.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

    <script>
        // ============================================
        // „Å∑„Å´„Å∑„Å´„Ç¢„Éã„Éû„É´„Éª„Éû„Éº„Ç∏ - Game Engine
        // ============================================

        // --- Matter.js „É¢„Ç∏„É•„Éº„É´ ---
        const { Engine, Render, Runner, Bodies, Body, World, Events, Query } = Matter;

        // --- ÂÆöÊï∞ (ÂèØÂ§â) ---
        let CANVAS_WIDTH = 350;
        let CANVAS_HEIGHT = 550;
        const ASPECT_RATIO = 350 / 550;
        let WALL_THICKNESS = 20;
        let DEADLINE_Y = 60;
        const DANGER_TIME = 3000;

        // --- ÂãïÁâ©ÂÆöÁæ© (Âü∫Ê∫ñ) ---
        const BASE_ANIMALS = [
            { name: '„Éí„É®„Ç≥', radius: 18, color: '#FFE066', earColor: '#FFD700', bodyColor: '#FFFACD' },
            { name: '„Éè„É†„Çπ„Çø„Éº', radius: 24, color: '#FFDAB9', earColor: '#DEB887', bodyColor: '#FFE4C4' },
            { name: '„Ç¶„Çµ„ÇÆ', radius: 32, color: '#FFB6C1', earColor: '#FF69B4', bodyColor: '#FFC0CB' },
            { name: '„Éç„Ç≥', radius: 42, color: '#E6E6FA', earColor: '#DDA0DD', bodyColor: '#F0E6FA' },
            { name: '„Ç§„Éå', radius: 54, color: '#B5EAD7', earColor: '#98D8C8', bodyColor: '#C5F0E0' },
            { name: '„É¨„ÉÉ„Çµ„Éº„Éë„É≥„ÉÄ', radius: 68, color: '#FFCBA4', earColor: '#8B4513', bodyColor: '#FFD8B8' },
            { name: '„Éí„ÉÑ„Ç∏', radius: 84, color: '#FAFAFA', earColor: '#D3D3D3', bodyColor: '#FFFFFF' },
            { name: '„ÇØ„Éû', radius: 102, color: '#DEB887', earColor: '#8B4513', bodyColor: '#E8C89E' },
            { name: '„É©„Ç§„Ç™„É≥', radius: 122, color: '#FFD700', earColor: '#DAA520', bodyColor: '#FFE55C' },
            { name: '„Çæ„Ç¶', radius: 145, color: '#C0C0C0', earColor: '#A9A9A9', bodyColor: '#D3D3D3' }
        ];

        // ‰ΩúÊ•≠Áî®ÂãïÁâ©„É™„Çπ„Éà„Å®„Çπ„Ç±„Éº„É´
        let ANIMALS = JSON.parse(JSON.stringify(BASE_ANIMALS));
        let scaleFactor = 1.0;

        // „Çπ„Ç≥„Ç¢„Éù„Ç§„É≥„Éà
        const SCORES = [10, 20, 40, 80, 160, 320, 640, 1280, 2560, 5120];

        // --- „Ç≤„Éº„É†Áä∂ÊÖã ---
        let engine, world, runner;
        let canvas, ctx, nextCanvas, nextCtx;
        let gameBox;
        let isGameRunning = false;
        let isGameOver = false;
        let score = 0;
        let bestScore = parseInt(localStorage.getItem('animalMergeBest') || '0');
        let currentAnimalIndex = 0;
        let nextAnimalIndex = 0;
        let canDrop = true;
        let mouseX = 0;
        let dangerTimer = null;
        let dangerStartTime = null;
        let animals = []; // ËêΩ‰∏ã„Åó„ÅüÂãïÁâ©„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÁÆ°ÁêÜ

        // --- ÂàùÊúüÂåñ ---
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            nextCanvas = document.getElementById('nextCanvas');
            nextCtx = nextCanvas.getContext('2d');
            gameBox = document.getElementById('gameBox');

            document.getElementById('bestScore').textContent = bestScore;

            // „É™„Çµ„Ç§„Ç∫ÂÆüË°å
            handleResize();
            window.addEventListener('resize', () => {
                handleResize();
                if (!isGameRunning) drawPreview();
            });

            // „Ç§„Éô„É≥„Éà
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('restartBtn').addEventListener('click', restartGame);

            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('click', handleClick);
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });

            // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÁîüÊàê
            createParticles();

            // ÂàùÊúüÊèèÁîª
            drawPreview();
            drawNextAnimal();
        }

        // --- „É™„Çµ„Ç§„Ç∫Âá¶ÁêÜ ---
        function handleResize() {
            const container = document.querySelector('.game-area');
            if (!container) return;

            // Â∞ë„Åó‰ΩôÁôΩ„ÇíË®≠„Åë„Çã (‰∏ä‰∏ãÂ∑¶Âè≥)
            // Â∑¶ÂØÑ„ÅõÊà¶Áï•: Âè≥ÂÅ¥„ÅÆHUD(Á¥Ñ80px)„ÇíÈÅø„Åë„Å¶„ÄÅÂ∑¶ÂÅ¥„ÅÆ„Çπ„Éö„Éº„Çπ„ÅßÊúÄÂ§ßÂåñ„Åô„Çã
            // ÂπÖ: ÂÖ®ÂπÖ - Âè≥„Éû„Éº„Ç∏„É≥(90px) - Â∑¶„Éë„Éá„Ç£„É≥„Ç∞(15px)
            // È´ò„Åï: ÂÖ®È´ò - ‰∏ä‰∏ã„Éû„Éº„Ç∏„É≥(50px: „Éò„ÉÉ„ÉÄ„Éº„ÇÑÂÆâÂÖ®„Éû„Éº„Ç∏„É≥)
            const maxWidth = container.clientWidth - 105;
            const maxHeight = container.clientHeight - 50;

            // „Ç¢„Çπ„Éö„ÇØ„ÉàÊØîÁ∂≠ÊåÅ„ÅßÊúÄÂ§ßÂåñ
            let w = maxHeight * ASPECT_RATIO;
            let h = maxHeight;

            if (w > maxWidth) {
                w = maxWidth;
                h = w / ASPECT_RATIO;
            }

            CANVAS_WIDTH = w;
            CANVAS_HEIGHT = h;
            scaleFactor = CANVAS_WIDTH / 350; // Âü∫Ê∫ñ350px

            canvas.width = CANVAS_WIDTH;
            canvas.height = CANVAS_HEIGHT;
            gameBox.style.width = CANVAS_WIDTH + 'px';
            gameBox.style.height = CANVAS_HEIGHT + 'px';

            // ÂãïÁâ©„Çµ„Ç§„Ç∫„Å®Â£ÅÂéö„Åø„ÅÆÂÜçË®àÁÆó
            ANIMALS = BASE_ANIMALS.map(a => ({
                ...a,
                radius: a.radius * scaleFactor
            }));
            WALL_THICKNESS = 20 * scaleFactor;
            DEADLINE_Y = 60 * scaleFactor;

            // „Éá„ÉÉ„Éâ„É©„Ç§„É≥Ë¶ÅÁ¥†„ÅÆ‰ΩçÁΩÆË™øÊï¥ÔºàCSS„Åßtop: 60px„Å™„ÅÆ„ÇíJS„Åß‰∏äÊõ∏„Åç„Åó„ÅüÊñπ„ÅåËâØ„ÅÑ„Åå„ÄÅCSS„ÅØÂõ∫ÂÆö„Å™„ÅÆ„Åß...Ôºâ
            // CSS„ÅÆ.deadline„ÅÆtop„ÇÇJS„Åß‰∏äÊõ∏„Åç
            document.querySelector('.deadline').style.top = DEADLINE_Y + 'px';
        }

        // --- „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÁîüÊàê ---
        function createParticles() {
            const container = document.getElementById('particles');
            const colors = ['#ffc8dd', '#bde0fe', '#a2d2ff', '#cdb4db', '#b5ead7'];

            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.width = (Math.random() * 15 + 5) + 'px';
                particle.style.height = particle.style.width;
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.animationDelay = (Math.random() * 8) + 's';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                container.appendChild(particle);
            }
        }

        // --- „Ç≤„Éº„É†ÈñãÂßã ---
        function startGame() {
            isGameRunning = true;
            isGameOver = false;
            score = 0;
            animals = [];
            canDrop = true;
            dangerTimer = null;
            dangerStartTime = null;

            document.getElementById('score').textContent = '0';
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('gameOverOverlay').classList.remove('active');
            // Ë≠¶ÂëäÂàùÊúüÂåñ‰∏çË¶Å

            // Matter.js „Ç®„É≥„Ç∏„É≥ÂàùÊúüÂåñ
            engine = Engine.create();
            world = engine.world;
            engine.world.gravity.y = 1;

            // Â£ÅÁîüÊàê
            const walls = [
                Bodies.rectangle(CANVAS_WIDTH / 2, CANVAS_HEIGHT + WALL_THICKNESS / 2, CANVAS_WIDTH, WALL_THICKNESS, { isStatic: true, label: 'floor' }),
                Bodies.rectangle(-WALL_THICKNESS / 2, CANVAS_HEIGHT / 2, WALL_THICKNESS, CANVAS_HEIGHT, { isStatic: true, label: 'leftWall' }),
                Bodies.rectangle(CANVAS_WIDTH + WALL_THICKNESS / 2, CANVAS_HEIGHT / 2, WALL_THICKNESS, CANVAS_HEIGHT, { isStatic: true, label: 'rightWall' })
            ];
            World.add(world, walls);

            // Ë°ùÁ™Å„Ç§„Éô„É≥„Éà
            Events.on(engine, 'collisionStart', handleCollision);

            // Ê¨°„ÅÆÂãïÁâ©„ÇíË®≠ÂÆö
            currentAnimalIndex = getRandomAnimalIndex();
            nextAnimalIndex = getRandomAnimalIndex();
            drawNextAnimal();

            // „Ç≤„Éº„É†„É´„Éº„ÉóÈñãÂßã
            runner = Runner.create();
            Runner.run(runner, engine);

            requestAnimationFrame(gameLoop);
        }

        // --- „Ç≤„Éº„É†„É™„Çπ„Çø„Éº„Éà ---
        function restartGame() {
            if (runner) {
                Runner.stop(runner);
            }
            if (engine) {
                World.clear(world);
                Engine.clear(engine);
            }
            startGame();
        }

        // --- „É©„É≥„ÉÄ„É†ÂãïÁâ©„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ (ÊúÄÂàù„ÅÆ5Á®ÆÈ°û„ÅÆ„ÅøÂá∫Áèæ) ---
        function getRandomAnimalIndex() {
            return Math.floor(Math.random() * 5);
        }

        // --- „Éû„Ç¶„Çπ/„Çø„ÉÉ„ÉÅÊìç‰Ωú ---
        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            clampMouseX();
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            mouseX = e.touches[0].clientX - rect.left;
            clampMouseX();
        }

        function clampMouseX() {
            const r = ANIMALS[currentAnimalIndex].radius;
            mouseX = Math.max(r + 5, Math.min(CANVAS_WIDTH - r - 5, mouseX));
        }

        function handleClick(e) {
            if (!isGameRunning || !canDrop || isGameOver) return;
            dropAnimal();
        }

        function handleTouchStart(e) {
            e.preventDefault();
            if (!isGameRunning || !canDrop || isGameOver) return;
            const rect = canvas.getBoundingClientRect();
            mouseX = e.touches[0].clientX - rect.left;
            clampMouseX();
            dropAnimal();
        }

        // --- ÂãïÁâ©„Éâ„É≠„ÉÉ„Éó ---
        function dropAnimal() {
            canDrop = false;
            const animal = ANIMALS[currentAnimalIndex];

            const body = Bodies.circle(mouseX, 40, animal.radius, {
                restitution: 0.2,
                friction: 0.5,
                frictionAir: 0.01,
                label: 'animal',
                animalIndex: currentAnimalIndex
            });

            World.add(world, body);
            animals.push(body);

            // Ê¨°„ÅÆÂãïÁâ©
            currentAnimalIndex = nextAnimalIndex;
            nextAnimalIndex = getRandomAnimalIndex();
            drawNextAnimal();

            // „Éâ„É≠„ÉÉ„Éó„ÇØ„Éº„É´„ÉÄ„Ç¶„É≥
            setTimeout(() => {
                canDrop = true;
            }, 500);
        }

        // --- Ë°ùÁ™ÅÂá¶ÁêÜ ---
        function handleCollision(event) {
            const pairs = event.pairs;

            for (const pair of pairs) {
                const bodyA = pair.bodyA;
                const bodyB = pair.bodyB;

                if (bodyA.label === 'animal' && bodyB.label === 'animal') {
                    if (bodyA.animalIndex === bodyB.animalIndex && bodyA.animalIndex < ANIMALS.length - 1) {
                        // „Éû„Éº„Ç∏Âá¶ÁêÜ
                        const newIndex = bodyA.animalIndex + 1;
                        const newX = (bodyA.position.x + bodyB.position.x) / 2;
                        const newY = (bodyA.position.y + bodyB.position.y) / 2;

                        // Âè§„ÅÑÂãïÁâ©„ÇíÂâäÈô§
                        World.remove(world, bodyA);
                        World.remove(world, bodyB);
                        animals = animals.filter(a => a !== bodyA && a !== bodyB);

                        // Êñ∞„Åó„ÅÑÂãïÁâ©„ÇíÁîüÊàê
                        const newAnimal = ANIMALS[newIndex];
                        const newBody = Bodies.circle(newX, newY, newAnimal.radius, {
                            restitution: 0.2,
                            friction: 0.5,
                            frictionAir: 0.01,
                            label: 'animal',
                            animalIndex: newIndex
                        });
                        World.add(world, newBody);
                        animals.push(newBody);

                        // „Çπ„Ç≥„Ç¢Âä†ÁÆó
                        score += SCORES[newIndex];
                        document.getElementById('score').textContent = score;

                        // „Éû„Éº„Ç∏„Ç®„Éï„Çß„ÇØ„Éà
                        showMergeEffect(newX, newY, newAnimal.radius);

                        // ÂèçÈáçÂäõ„Ç®„Éï„Çß„ÇØ„Éà - Âë®Âõ≤„ÅÆÂãïÁâ©„ÇíÂ∞ë„ÅóÊµÆ„Åã„Åõ„Çã
                        applyAntiGravityEffect(newX, newY);

                        break; // 1„Éï„É¨„Éº„É†„Å´1„Éû„Éº„Ç∏„ÅÆ„Åø
                    }
                }
            }
        }

        // --- „Éû„Éº„Ç∏„Ç®„Éï„Çß„ÇØ„Éà ---
        function showMergeEffect(x, y, radius) {
            const effect = document.createElement('div');
            effect.className = 'merge-effect';
            effect.style.left = (x - radius) + 'px';
            effect.style.top = (y - radius) + 'px';
            effect.style.width = (radius * 2) + 'px';
            effect.style.height = (radius * 2) + 'px';
            gameBox.appendChild(effect);

            setTimeout(() => effect.remove(), 400);
        }

        // --- ÂèçÈáçÂäõ„Ç®„Éï„Çß„ÇØ„Éà ---
        function applyAntiGravityEffect(centerX, centerY) {
            for (const body of animals) {
                const dx = body.position.x - centerX;
                const dy = body.position.y - centerY;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < 200 && dist > 0) {
                    const force = 0.015 * (1 - dist / 200);
                    Body.applyForce(body, body.position, {
                        x: 0,
                        y: -force
                    });
                }
            }
        }

        // --- „Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÂà§ÂÆö ---
        function checkGameOver() {
            let anyAboveDeadline = false;

            for (const body of animals) {
                if (body.position.y - ANIMALS[body.animalIndex].radius < DEADLINE_Y) {
                    anyAboveDeadline = true;
                    break;
                }
            }

            if (anyAboveDeadline) {
                if (!dangerStartTime) {
                    dangerStartTime = Date.now();
                    // Ë≠¶ÂëäË°®Á§∫„Å™„Åó
                } else if (Date.now() - dangerStartTime > DANGER_TIME) {
                    endGame();
                }
            } else {
                dangerStartTime = null;
                // Ë≠¶ÂëäÈùûË°®Á§∫„Å™„Åó
            }
        }

        // --- „Ç≤„Éº„É†ÁµÇ‰∫Ü ---
        function endGame() {
            isGameOver = true;
            isGameRunning = false;

            if (runner) Runner.stop(runner);

            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverOverlay').classList.add('active');
            document.getElementById('startBtn').style.display = 'block';

            // „Éô„Çπ„Éà„Çπ„Ç≥„Ç¢Êõ¥Êñ∞
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('animalMergeBest', bestScore);
                document.getElementById('bestScore').textContent = bestScore;
            }
        }

        // --- ÊèèÁîª: NextÂãïÁâ© ---
        function drawNextAnimal() {
            nextCtx.clearRect(0, 0, 50, 50);
            const animal = ANIMALS[nextAnimalIndex];
            const scale = 40 / (animal.radius * 2);
            const r = animal.radius * scale;
            drawAnimalShape(nextCtx, 25, 25, r, animal, nextAnimalIndex);
        }

        // --- ÊèèÁîª: „Éó„É¨„Éì„É•„Éº ---
        function drawPreview() {
            if (!isGameRunning || !canDrop) return;

            const animal = ANIMALS[currentAnimalIndex];

            // „Éâ„É≠„ÉÉ„Éó„É©„Ç§„É≥
            ctx.save();
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = 'rgba(160, 140, 200, 0.4)';
            ctx.beginPath();
            ctx.moveTo(mouseX, 50);
            ctx.lineTo(mouseX, CANVAS_HEIGHT);
            ctx.stroke();
            ctx.restore();

            // „Éó„É¨„Éì„É•„ÉºÂãïÁâ©
            ctx.globalAlpha = 0.6;
            drawAnimalShape(ctx, mouseX, 40, animal.radius, animal, currentAnimalIndex);
            ctx.globalAlpha = 1;
        }

        // --- ÂãïÁâ©ÊèèÁîªÈñ¢Êï∞ ---
        function drawAnimalShape(context, x, y, radius, animal, index, angle = 0) {
            const r = radius;

            // ÂΩ±
            context.save();
            context.fillStyle = 'rgba(0,0,0,0.15)';
            context.beginPath();
            context.arc(x + 3, y + 3, r, 0, Math.PI * 2);
            context.fill();
            context.restore();

            // ÂõûËª¢ÈÅ©Áî® (‰Ωì„ÉªÈ°î„Éª„Éè„Ç§„É©„Ç§„Éà)
            context.save();
            context.translate(x, y);
            context.rotate(angle);
            context.translate(-x, -y);

            // ‰Ωì („É°„Ç§„É≥„ÅÆÂÜÜ)
            context.save();
            const gradient = context.createRadialGradient(x - r * 0.3, y - r * 0.3, 0, x, y, r);
            gradient.addColorStop(0, animal.bodyColor);
            gradient.addColorStop(1, animal.color);
            context.fillStyle = gradient;
            context.beginPath();
            context.arc(x, y, r, 0, Math.PI * 2);
            context.fill();
            context.restore();

            // ÂãïÁâ©„Åî„Å®„ÅÆÁâπÂæ¥ÊèèÁîª
            switch (index) {
                case 0: drawChick(context, x, y, r); break;
                case 1: drawHamster(context, x, y, r); break;
                case 2: drawRabbit(context, x, y, r); break;
                case 3: drawCat(context, x, y, r); break;
                case 4: drawDog(context, x, y, r); break;
                case 5: drawRedPanda(context, x, y, r); break;
                case 6: drawSheep(context, x, y, r); break;
                case 7: drawBear(context, x, y, r); break;
                case 8: drawLion(context, x, y, r); break;
                case 9: drawElephant(context, x, y, r); break;
            }

            // „Éè„Ç§„É©„Ç§„Éà (ÂÖâÊ≤¢)
            context.save();
            context.fillStyle = 'rgba(255,255,255,0.5)';
            context.beginPath();
            context.ellipse(x - r * 0.35, y - r * 0.35, r * 0.25, r * 0.15, -Math.PI / 4, 0, Math.PI * 2);
            context.fill();
            context.restore();

            // ÂõûËª¢ÁµÇ‰∫Ü
            context.restore();
        }

        // --- ÂêÑÂãïÁâ©„ÅÆÁâπÂæ¥ÊèèÁîª ---
        function drawChick(ctx, x, y, r) {
            // „ÇØ„ÉÅ„Éê„Ç∑
            ctx.fillStyle = '#FFA500';
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + r * 0.4, y + r * 0.2);
            ctx.lineTo(x, y + r * 0.4);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x - r * 0.25, y - r * 0.1, r * 0.12, 0, Math.PI * 2);
            ctx.fill();
            // È†≠„ÅÆÁæΩ
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.ellipse(x, y - r * 0.9, r * 0.15, r * 0.3, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawHamster(ctx, x, y, r) {
            // ËÄ≥
            ctx.fillStyle = '#DEB887';
            ctx.beginPath();
            ctx.arc(x - r * 0.7, y - r * 0.5, r * 0.3, 0, Math.PI * 2);
            ctx.arc(x + r * 0.7, y - r * 0.5, r * 0.3, 0, Math.PI * 2);
            ctx.fill();
            // „Åª„Å£„Å∫
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.arc(x - r * 0.5, y + r * 0.2, r * 0.25, 0, Math.PI * 2);
            ctx.arc(x + r * 0.5, y + r * 0.2, r * 0.25, 0, Math.PI * 2);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x - r * 0.3, y - r * 0.15, r * 0.1, 0, Math.PI * 2);
            ctx.arc(x + r * 0.3, y - r * 0.15, r * 0.1, 0, Math.PI * 2);
            ctx.fill();
            // Èºª
            ctx.fillStyle = '#FF69B4';
            ctx.beginPath();
            ctx.arc(x, y + r * 0.1, r * 0.08, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawRabbit(ctx, x, y, r) {
            // Èï∑„ÅÑËÄ≥
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.ellipse(x - r * 0.4, y - r * 1.1, r * 0.2, r * 0.5, -0.2, 0, Math.PI * 2);
            ctx.ellipse(x + r * 0.4, y - r * 1.1, r * 0.2, r * 0.5, 0.2, 0, Math.PI * 2);
            ctx.fill();
            // ËÄ≥„ÅÆÂÜÖÂÅ¥
            ctx.fillStyle = '#FF69B4';
            ctx.beginPath();
            ctx.ellipse(x - r * 0.4, y - r * 1.1, r * 0.1, r * 0.35, -0.2, 0, Math.PI * 2);
            ctx.ellipse(x + r * 0.4, y - r * 1.1, r * 0.1, r * 0.35, 0.2, 0, Math.PI * 2);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#FF1493';
            ctx.beginPath();
            ctx.arc(x - r * 0.3, y - r * 0.1, r * 0.12, 0, Math.PI * 2);
            ctx.arc(x + r * 0.3, y - r * 0.1, r * 0.12, 0, Math.PI * 2);
            ctx.fill();
            // Èºª
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.arc(x, y + r * 0.15, r * 0.1, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawCat(ctx, x, y, r) {
            // ‰∏âËßíËÄ≥
            ctx.fillStyle = '#DDA0DD';
            ctx.beginPath();
            ctx.moveTo(x - r * 0.7, y - r * 0.4);
            ctx.lineTo(x - r * 0.4, y - r * 1);
            ctx.lineTo(x - r * 0.1, y - r * 0.4);
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(x + r * 0.7, y - r * 0.4);
            ctx.lineTo(x + r * 0.4, y - r * 1);
            ctx.lineTo(x + r * 0.1, y - r * 0.4);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#32CD32';
            ctx.beginPath();
            ctx.ellipse(x - r * 0.3, y - r * 0.1, r * 0.15, r * 0.18, 0, 0, Math.PI * 2);
            ctx.ellipse(x + r * 0.3, y - r * 0.1, r * 0.15, r * 0.18, 0, 0, Math.PI * 2);
            ctx.fill();
            // Áû≥
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.ellipse(x - r * 0.3, y - r * 0.1, r * 0.05, r * 0.12, 0, 0, Math.PI * 2);
            ctx.ellipse(x + r * 0.3, y - r * 0.1, r * 0.05, r * 0.12, 0, 0, Math.PI * 2);
            ctx.fill();
            // Èºª
            ctx.fillStyle = '#FF69B4';
            ctx.beginPath();
            ctx.moveTo(x, y + r * 0.05);
            ctx.lineTo(x - r * 0.08, y + r * 0.18);
            ctx.lineTo(x + r * 0.08, y + r * 0.18);
            ctx.fill();
            // „Å≤„Åí
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(x - r * 0.2, y + r * 0.15);
            ctx.lineTo(x - r * 0.6, y + r * 0.1);
            ctx.moveTo(x - r * 0.2, y + r * 0.25);
            ctx.lineTo(x - r * 0.6, y + r * 0.25);
            ctx.moveTo(x + r * 0.2, y + r * 0.15);
            ctx.lineTo(x + r * 0.6, y + r * 0.1);
            ctx.moveTo(x + r * 0.2, y + r * 0.25);
            ctx.lineTo(x + r * 0.6, y + r * 0.25);
            ctx.stroke();
        }

        function drawDog(ctx, x, y, r) {
            // ÂûÇ„ÇåËÄ≥
            ctx.fillStyle = '#7CB9A8';
            ctx.beginPath();
            ctx.ellipse(x - r * 0.75, y - r * 0.2, r * 0.25, r * 0.45, -0.3, 0, Math.PI * 2);
            ctx.ellipse(x + r * 0.75, y - r * 0.2, r * 0.25, r * 0.45, 0.3, 0, Math.PI * 2);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x - r * 0.3, y - r * 0.15, r * 0.12, 0, Math.PI * 2);
            ctx.arc(x + r * 0.3, y - r * 0.15, r * 0.12, 0, Math.PI * 2);
            ctx.fill();
            // ÁõÆ„ÅÆ„Éè„Ç§„É©„Ç§„Éà
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(x - r * 0.26, y - r * 0.18, r * 0.04, 0, Math.PI * 2);
            ctx.arc(x + r * 0.34, y - r * 0.18, r * 0.04, 0, Math.PI * 2);
            ctx.fill();
            // Èºª
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.ellipse(x, y + r * 0.15, r * 0.15, r * 0.1, 0, 0, Math.PI * 2);
            ctx.fill();
            // Ëàå
            ctx.fillStyle = '#FF69B4';
            ctx.beginPath();
            ctx.ellipse(x, y + r * 0.4, r * 0.1, r * 0.15, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawRedPanda(ctx, x, y, r) {
            // ËÄ≥
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.arc(x - r * 0.7, y - r * 0.6, r * 0.25, 0, Math.PI * 2);
            ctx.arc(x + r * 0.7, y - r * 0.6, r * 0.25, 0, Math.PI * 2);
            ctx.fill();
            // ÁôΩ„ÅÑ„Éû„Çπ„ÇØÊ®°Êßò
            ctx.fillStyle = '#FFFAF0';
            ctx.beginPath();
            ctx.ellipse(x, y + r * 0.1, r * 0.5, r * 0.35, 0, 0, Math.PI * 2);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x - r * 0.3, y - r * 0.1, r * 0.1, 0, Math.PI * 2);
            ctx.arc(x + r * 0.3, y - r * 0.1, r * 0.1, 0, Math.PI * 2);
            ctx.fill();
            // Èºª
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x, y + r * 0.15, r * 0.08, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawSheep(ctx, x, y, r) {
            // „ÇÇ„Åì„ÇÇ„Åì
            ctx.fillStyle = '#FAFAFA';
            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                const cx = x + Math.cos(angle) * r * 0.7;
                const cy = y + Math.sin(angle) * r * 0.7;
                ctx.beginPath();
                ctx.arc(cx, cy, r * 0.35, 0, Math.PI * 2);
                ctx.fill();
            }
            // È°î
            ctx.fillStyle = '#FFE4E1';
            ctx.beginPath();
            ctx.arc(x, y, r * 0.55, 0, Math.PI * 2);
            ctx.fill();
            // ËÄ≥
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.ellipse(x - r * 0.5, y - r * 0.15, r * 0.15, r * 0.25, -0.5, 0, Math.PI * 2);
            ctx.ellipse(x + r * 0.5, y - r * 0.15, r * 0.15, r * 0.25, 0.5, 0, Math.PI * 2);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x - r * 0.2, y - r * 0.1, r * 0.07, 0, Math.PI * 2);
            ctx.arc(x + r * 0.2, y - r * 0.1, r * 0.07, 0, Math.PI * 2);
            ctx.fill();
            // Èºª
            ctx.fillStyle = '#FF69B4';
            ctx.beginPath();
            ctx.arc(x, y + r * 0.1, r * 0.06, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawBear(ctx, x, y, r) {
            // ‰∏∏ËÄ≥
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.arc(x - r * 0.7, y - r * 0.6, r * 0.3, 0, Math.PI * 2);
            ctx.arc(x + r * 0.7, y - r * 0.6, r * 0.3, 0, Math.PI * 2);
            ctx.fill();
            // ËÄ≥„ÅÆÂÜÖÂÅ¥
            ctx.fillStyle = '#BC8F8F';
            ctx.beginPath();
            ctx.arc(x - r * 0.7, y - r * 0.6, r * 0.18, 0, Math.PI * 2);
            ctx.arc(x + r * 0.7, y - r * 0.6, r * 0.18, 0, Math.PI * 2);
            ctx.fill();
            // „Éû„Ç∫„É´
            ctx.fillStyle = '#F5DEB3';
            ctx.beginPath();
            ctx.ellipse(x, y + r * 0.2, r * 0.35, r * 0.25, 0, 0, Math.PI * 2);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x - r * 0.3, y - r * 0.15, r * 0.1, 0, Math.PI * 2);
            ctx.arc(x + r * 0.3, y - r * 0.15, r * 0.1, 0, Math.PI * 2);
            ctx.fill();
            // Èºª
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.ellipse(x, y + r * 0.15, r * 0.12, r * 0.08, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawLion(ctx, x, y, r) {
            // „Åü„Å¶„Åå„Åø
            ctx.fillStyle = '#DAA520';
            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * Math.PI * 2;
                const cx = x + Math.cos(angle) * r * 0.8;
                const cy = y + Math.sin(angle) * r * 0.8;
                ctx.beginPath();
                ctx.arc(cx, cy, r * 0.35, 0, Math.PI * 2);
                ctx.fill();
            }
            // È°î
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y, r * 0.65, 0, Math.PI * 2);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.arc(x - r * 0.25, y - r * 0.1, r * 0.1, 0, Math.PI * 2);
            ctx.arc(x + r * 0.25, y - r * 0.1, r * 0.1, 0, Math.PI * 2);
            ctx.fill();
            // Èºª
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.moveTo(x, y + r * 0.05);
            ctx.lineTo(x - r * 0.1, y + r * 0.2);
            ctx.lineTo(x + r * 0.1, y + r * 0.2);
            ctx.fill();
            // Âè£
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, y + r * 0.2);
            ctx.lineTo(x, y + r * 0.35);
            ctx.moveTo(x - r * 0.15, y + r * 0.35);
            ctx.quadraticCurveTo(x, y + r * 0.45, x + r * 0.15, y + r * 0.35);
            ctx.stroke();
        }

        function drawElephant(ctx, x, y, r) {
            // Â§ß„Åç„Å™ËÄ≥
            ctx.fillStyle = '#A9A9A9';
            ctx.beginPath();
            ctx.ellipse(x - r * 0.85, y - r * 0.1, r * 0.45, r * 0.6, -0.3, 0, Math.PI * 2);
            ctx.ellipse(x + r * 0.85, y - r * 0.1, r * 0.45, r * 0.6, 0.3, 0, Math.PI * 2);
            ctx.fill();
            // ËÄ≥„ÅÆÂÜÖÂÅ¥
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.ellipse(x - r * 0.85, y - r * 0.1, r * 0.3, r * 0.45, -0.3, 0, Math.PI * 2);
            ctx.ellipse(x + r * 0.85, y - r * 0.1, r * 0.3, r * 0.45, 0.3, 0, Math.PI * 2);
            ctx.fill();
            // Èºª
            ctx.fillStyle = '#B8B8B8';
            ctx.beginPath();
            ctx.moveTo(x - r * 0.15, y + r * 0.1);
            ctx.quadraticCurveTo(x - r * 0.2, y + r * 0.5, x, y + r * 0.8);
            ctx.quadraticCurveTo(x + r * 0.2, y + r * 0.5, x + r * 0.15, y + r * 0.1);
            ctx.fill();
            // ÁõÆ
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(x - r * 0.3, y - r * 0.2, r * 0.08, 0, Math.PI * 2);
            ctx.arc(x + r * 0.3, y - r * 0.2, r * 0.08, 0, Math.PI * 2);
            ctx.fill();
        }

        // --- „Ç≤„Éº„É†„É´„Éº„Éó ---
        function gameLoop() {
            if (!isGameRunning) return;

            // „Ç≠„É£„É≥„Éê„Çπ„ÇØ„É™„Ç¢
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // ÂãïÁâ©ÊèèÁîª
            const bodies = Matter.Composite.allBodies(world);
            for (const body of bodies) {
                if (body.label === 'animal') {
                    const animal = ANIMALS[body.animalIndex];
                    drawAnimalShape(ctx, body.position.x, body.position.y, animal.radius, animal, body.animalIndex, body.angle);
                }
            }

            // „Éó„É¨„Éì„É•„ÉºÊèèÁîª
            drawPreview();

            // „Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÂà§ÂÆö
            checkGameOver();

            requestAnimationFrame(gameLoop);
        }

        // --- ÂàùÊúüÂåñÂÆüË°å ---
        init();
    </script>
</body>

</html>