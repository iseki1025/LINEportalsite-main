<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ç½å®³æƒ…å ±ãƒãƒ¼ã‚¿ãƒ« | æ¢¶æœ¬ã‚¯ãƒªãƒ‹ãƒƒã‚¯</title>
    <link rel="stylesheet" href="portal-design.css">
    <style>
        /* Status Panel (Open by default) */
        .status-panel.open .status-panel-content {
            display: block;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-title">ç½å®³æƒ…å ±ãƒãƒ¼ã‚¿ãƒ«</div>
    </header>

    <!-- Main Content -->
    <main class="main-content">

        <!-- Dialysis Status Panel -->
        <div class="status-panel open" id="dialysis-status-panel">
            <div class="status-panel-header" onclick="this.parentElement.classList.toggle('open')">
                <span class="status-panel-title">ç¾åœ¨ã®é€æçŠ¶æ³</span>
                <span class="status-panel-toggle">â–¼ ã‚¿ãƒƒãƒ—ã§é–‹é–‰</span>
            </div>
            <div class="status-panel-content">
                <div class="status-grid" id="dialysisStatusContainer">
                    <p style="text-align:center; padding: 1rem;">èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
                <p style="text-align:center; margin-top: 1rem; font-size: 0.8rem; color: var(--text-muted);">
                    â€»ã“ã®æƒ…å ±ã¯ç½å®³æ™‚ãªã©ã«éšæ™‚æ›´æ–°ã•ã‚Œã¾ã™ã€‚
                </p>
            </div>
        </div>

        <!-- PDF Guide Book (Collapsible) -->
        <div class="collapsible" id="pdf-guide">
            <div class="collapsible-header" onclick="this.parentElement.classList.toggle('open')">
                <span class="collapsible-title">ğŸ“– é˜²ç½ã‚¬ã‚¤ãƒ‰ãƒ–ãƒƒã‚¯ã‚’è¦‹ã‚‹</span>
                <span class="collapsible-icon">â–¼</span>
            </div>
            <div class="collapsible-content">
                <p style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
                    è©³ã—ã„å¯¾ç­–ã‚’PDFã§ç¢ºèªã§ãã¾ã™ã€‚
                </p>
                <div style="text-align: center;">
                    <a href="files/pdf/disaster-guide-book.pdf" target="_blank" class="btn btn-primary">
                        PDFã‚’é–‹ã
                    </a>
                </div>
            </div>
        </div>

        <!-- Hero Section -->
        <section class="hero-section theme-disaster">
            <h1 class="hero-title">å‚™ãˆã‚ã‚Œã°æ†‚ã„ãªã—</h1>
            <p class="hero-subtitle">
                ã„ã–ã¨ã„ã†æ™‚ã®å‚™ãˆã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚<br>
                æ—¥é ƒã®æº–å‚™ãŒã‚ãªãŸã‚’å®ˆã‚Šã¾ã™ã€‚
            </p>
        </section>

        <!-- Card Grid -->
        <div class="card-grid">
            <!-- Safety Contact -->
            <a href="disaster-safety.html" class="card accent-disaster">
                <div class="card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path
                            d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72">
                        </path>
                    </svg>
                </div>
                <div class="card-content">
                    <div class="card-title">å®‰å¦ç¢ºèªãƒ»é€£çµ¡å…ˆ</div>
                    <div class="card-desc">ç·Šæ€¥é€£çµ¡æ–¹æ³•ã®ç¢ºèª</div>
                </div>
            </a>

            <!-- Stock List -->
            <a href="disaster-stock.html" class="card accent-disaster">
                <div class="card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                        </path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                </div>
                <div class="card-content">
                    <div class="card-title">å‚™è“„ãƒ»æŒã¡å‡ºã—</div>
                    <div class="card-desc">å¿…è¦ãªç‰©è³‡ãƒªã‚¹ãƒˆ</div>
                </div>
            </a>

            <!-- Furniture Fixing -->
            <a href="disaster-furniture.html" class="card accent-disaster">
                <div class="card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                </div>
                <div class="card-content">
                    <div class="card-title">å®¶å…·ã®å›ºå®š</div>
                    <div class="card-desc">è»¢å€’é˜²æ­¢å¯¾ç­–</div>
                </div>
            </a>

            <!-- Hazard Map -->
            <a href="disaster-hazardmap.html" class="card accent-disaster">
                <div class="card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                        <line x1="8" y1="2" x2="8" y2="18"></line>
                        <line x1="16" y1="6" x2="16" y2="22"></line>
                    </svg>
                </div>
                <div class="card-content">
                    <div class="card-title">ãƒã‚¶ãƒ¼ãƒ‰ãƒãƒƒãƒ—</div>
                    <div class="card-desc">åœ°åŸŸã®å±é™ºåº¦ç¢ºèª</div>
                </div>
            </a>

            <!-- Evacuation -->
            <a href="disaster-evacuation.html" class="card accent-disaster">
                <div class="card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="5" r="3"></circle>
                        <path d="M12 8v8"></path>
                        <path d="M8 14l4 4 4-4"></path>
                    </svg>
                </div>
                <div class="card-content">
                    <div class="card-title">é¿é›£æ‰‹æ®µ</div>
                    <div class="card-desc">é™¢å†…é¿é›£è¨­å‚™</div>
                </div>
            </a>

            <!-- Disaster Q&A -->
            <a href="disaster-faq.html" class="card accent-disaster">
                <div class="card-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </div>
                <div class="card-content">
                    <div class="card-title">ç½å®³Q&A</div>
                    <div class="card-desc">ã‚ˆãã‚ã‚‹è³ªå•</div>
                </div>
            </a>
        </div>

        <!-- Copyright (Stealth link to index.html) -->
        <footer class="copyright">
            <a href="index.html" class="stealth-link">
                Â© 2025 Kajimoto Clinic
            </a>
        </footer>

    </main>

    <!-- Bottom Navigation (Q&A only - no link to friend) -->
    <nav class="bottom-nav">
        <a href="disaster-main.html" class="nav-item active">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                </path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <span>ç½å®³ãƒˆãƒƒãƒ—</span>
        </a>
        <a href="qa-main.html" class="nav-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <span>Q&A</span>
        </a>
    </nav>

    <!-- Firebase Script -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { firebaseConfig } from './js/firebase-config.js';

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            async function loadDialysisStatus() {
                const container = document.getElementById('dialysisStatusContainer');
                try {
                    const snapshot = await getDocs(collection(db, 'dialysis_status'));
                    container.innerHTML = '';

                    const facilities = [
                        { name: "æœ¬é™¢", id: "honin" },
                        { name: "ãªã‹ã‚‚ãšåˆ†é™¢", id: "nakamozu" },
                        { name: "ä¸‰å›½ãƒ¶ä¸˜åˆ†é™¢", id: "mikunigaoka" }
                    ];
                    const dataMap = {};
                    snapshot.forEach(doc => dataMap[doc.id] = doc.data());

                    facilities.forEach(fac => {
                        const data = dataMap[fac.name] || { status: 'available', reason: '' };
                        const badgeClass = data.status === 'available' ? 'ok' : 'ng';
                        const statusText = data.status === 'available' ? 'é€æå¯' : 'é€æä¸å¯';

                        const item = document.createElement('div');
                        item.className = `status-item ${fac.id}`;
                        item.innerHTML = `
                            <span class="status-name">${fac.name}</span>
                            <span class="status-badge ${badgeClass}">${statusText}</span>
                        `;
                        container.appendChild(item);

                        if (data.reason) {
                            const reason = document.createElement('div');
                            reason.style.cssText = 'width: 100%; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border-light); color: var(--accent-disaster); font-size: 0.85rem; font-weight: 500;';
                            reason.textContent = data.reason;
                            item.style.flexWrap = 'wrap';
                            item.appendChild(reason);
                        }
                    });
                } catch (error) {
                    console.error('Status load error:', error);
                    container.innerHTML = '<p style="padding:1rem; color: var(--accent-disaster);">çŠ¶æ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>';
                }
            }
            loadDialysisStatus();
        } catch (e) {
            console.error('Firebase init error:', e);
            document.getElementById('dialysisStatusContainer').innerHTML =
                '<p style="padding:1rem; color: var(--accent-disaster);">ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>(Localç’°å¢ƒã§ã¯ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã®é–²è¦§ãŒå¿…è¦ã§ã™)</p>';
        }
    </script>

</body>

</html>